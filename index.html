<!DOCTYPE html>
<html>

<head>
  <title>Galeri Panorama 360 VR</title>
  <meta name="description" content="Tugas VR dengan 13 Panorama">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- CSS eksternal kamu -->
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <a-scene id="scene" sound="src: #bgm; loop: true; volume: 0.5">
    <a-assets>
      <audio id="bgm" src="anging_mammiri.m4a" preload="auto"></audio>

      <img id="pano-1" src="images/pano1.jpg" crossorigin="anonymous">
      <img id="pano-2" src="images/pano2.jpg" crossorigin="anonymous">
      <img id="pano-3" src="images/pano3.jpg" crossorigin="anonymous">
      <img id="pano-4" src="images/pano4.jpg" crossorigin="anonymous">
      <img id="pano-5" src="images/pano5.jpg" crossorigin="anonymous">
      <img id="pano-6" src="images/pano6.jpg" crossorigin="anonymous">
      <img id="pano-7" src="images/pano7.jpg" crossorigin="anonymous">
      <img id="pano-8" src="images/pano8.jpg" crossorigin="anonymous">
      <img id="pano-9" src="images/pano9.jpg" crossorigin="anonymous">
      <img id="pano-10" src="images/pano10.jpg" crossorigin="anonymous">
      <img id="pano-11" src="images/pano11.jpg" crossorigin="anonymous">
      <img id="pano-12" src="images/pano12.jpg" crossorigin="anonymous">
      <img id="pano-13" src="images/pano13.jpg" crossorigin="anonymous">
    </a-assets>

    <!-- Panorama utama -->
    <a-sky id="panorama-sky" src="#pano-1" rotation="0 -90 0"
      animation__fadeout="property: material.opacity; from: 1; to: 0; dur: 600; startEvents: fadeout"
      animation__fadein="property: material.opacity; from: 0; to: 1; dur: 600; startEvents: fadein">
    </a-sky>

    <!-- Kamera dan cursor -->
    <a-entity id="rig">
      <a-entity camera position="0 1.6 0" look-controls>
        <a-cursor color="white" fuse="true" fuse-timeout="1000"></a-cursor>
      </a-entity>
    </a-entity>

    <!-- Container untuk hotspot -->
    <a-entity id="hotspotContainer"></a-entity>
  </a-scene>

  <script>
    const panoramas = [
      '#pano-1', '#pano-2', '#pano-3', '#pano-4', '#pano-5',
      '#pano-6', '#pano-7', '#pano-8', '#pano-9', '#pano-10',
      '#pano-11', '#pano-12', '#pano-13'
    ];

    let currentIndex = 0;
    let isMusicPlaying = false;

    const sceneEl = document.querySelector('#scene');
    const sky = document.querySelector('#panorama-sky');
    const hotspotContainer = document.querySelector('#hotspotContainer');

    function changePanorama(index) {
      if (index < 0) index = panoramas.length - 1;
      if (index >= panoramas.length) index = 0;
      currentIndex = index;

      sky.emit('fadeout');
      setTimeout(() => {
        sky.setAttribute('src', panoramas[currentIndex]);
        sky.emit('fadein');
        createHotspots();
      }, 600);
    }

    function createHotspots() {
      hotspotContainer.innerHTML = '';

      const next = document.createElement('a-entity');
      next.setAttribute('geometry', 'primitive: circle; radius: 0.3');
      next.setAttribute('material', 'color: white; opacity: 0.7');
      next.setAttribute('position', '-2 0 -3');
      next.setAttribute('rotation', '0 30 0');
      next.setAttribute('class', 'clickable');
      next.setAttribute('data-index', currentIndex + 1);
      hotspotContainer.appendChild(next);

      const prev = document.createElement('a-entity');
      prev.setAttribute('geometry', 'primitive: circle; radius: 0.3');
      prev.setAttribute('material', 'color: white; opacity: 0.7');
      prev.setAttribute('position', '2 0 -3');
      prev.setAttribute('rotation', '0 -30 0');
      prev.setAttribute('class', 'clickable');
      prev.setAttribute('data-index', currentIndex - 1);
      hotspotContainer.appendChild(prev);

      // Interaksi lewat gaze
      hotspotContainer.querySelectorAll('.clickable').forEach(spot => {
        spot.addEventListener('mouseenter', function () {
          if (!isMusicPlaying) {
            sceneEl.components.sound.playSound();
            isMusicPlaying = true;
          }
          const targetIndex = parseInt(this.getAttribute('data-index'));
          changePanorama(targetIndex);
        });
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      createHotspots();
    });
  </script>

</body>
</html>
